# 45S_methyl_caller
Call as:
```
bash pipeline.sh $fastq_path $45S_ref $out_dir
```

`fastq_path` should contain fastq/fasta files (can be compressed or uncompressed) labeled with their group names (ie. `hap1.fasta`, `chr14.fastq.gz`, `species.fq`, `individual.fa`), these group names will be carried through the rest of the analysis.

General pipeline:
1. makes file structure for outputs
2. maps ONT reads to 45S ref (or any ref you give it), filters for 90% alignment block and 90% identity, filters out suspected chimeric reads (identified as containing inverted 45S units)
3. splits up the alignments to get one alignment per file
4. calls modkit on these split alignments, getting per read methylation info (also calls on all reads per category)
5. summarizes data at the per group level, and the per unit level
6. ordering analysis: are neighboring units methylated more similarly than random units?
7. generates a per category violin plot


The outputs:
Everything is contained within the folder specified as `$out_dir`.

`$out_dir/alignment` contains outputs from the alignment and splitting stages.
* In the top level contains bams,beds,pafs for each group
* In `read_breakdown` contains subdirectories for each group, then for each readname
* Each readname folder contains a sam and bam per 45S unit

`$out_dir/get_methylation` contains outputs from running `modkit` to get methylation information from alignments. 
* `modkit_beds` contains the group level beds generated by `modkit`, as well as a `logs` folder
* `read_breakdown` is organized as in the `alignment` folder, with each readname folder containing one bed file per unit, as well as a `logs` folder

`$out_dir/methylation_analysis` contains final summary data generated by the pipeline.
 * `group_summary.txt` contains the group-level summary of %methylation
 * `read_summary.txt` contains the per-unit level data of %methylation (each row represents one unit on one read)
 * `output.png` contains a violin plot of group-level %methylation
 * `ordering_analysis.txt` contains the results of ordering analysis
